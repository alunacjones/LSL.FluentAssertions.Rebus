[![Build status](https://img.shields.io/appveyor/ci/alunacjones/lsl-fluentassertions-rebus.svg)](https://ci.appveyor.com/project/alunacjones/lsl-fluentassertions-rebus)
[![Coveralls branch](https://img.shields.io/coverallsCoverage/github/alunacjones/LSL.FluentAssertions.Rebus)](https://coveralls.io/github/alunacjones/LSL.FluentAssertions.Rebus)
[![NuGet](https://img.shields.io/nuget/v/LSL.FluentAssertions.Rebus.svg)](https://www.nuget.org/packages/LSL.FluentAssertions.Rebus/)

# LSL.FluentAssertions.Rebus

A convenience library to short cut common assertions when using the [Rebus.TestHelpers](https://www.nuget.org/packages/Rebus.TestHelpers) library.

Each of the `HaveXXX` methods returns a the standard collection assertion object provided by [FluentAssertions](https://www.nuget.org/packages/FluentAssertions)

## Simple assertion of a sent message

As we can see in the following example we are just asserting the message content via the regular collection assertion method `SatisfyRespectively` that is provided by `FluentAsserttions`

```csharp
using LSL.FluentAssertions.Rebus;
...
var bus = new FakeBus();
bus.Send("a message");
bus.Should().HaveMessageCount(1)
    .And
    .HaveSentMessages<string>()
    .And
    .SatisfyRespectively(m => m.CommandMessage.Should().Be("a message"));
```

## Testing for multiple messages

Here we assert against a sent message and a published event.

> NOTE: Since each method returns the underlying message type supported by `Rebus.TestHelpers` we had to use `CommandMessage` to access the sent message and `EventMessage` to access the published event.

```csharp
using LSL.FluentAssertions.Rebus;
...
var bus = new FakeBus();
bus.Send("a message");
bus.Publish("an event");

bus.Should().HaveMessageCount(2);
bus.Should().HaveSentMessages<string>()
    .And.SatisfyRespectively(m => m.CommandMessage.Should().Be("a message"));

bus.Should().HavePublishedMessages<string>()
    .And.SatisfyRespectively(m => m.EventMessage.Should().Be("an event"));
```

## Assertion method mappings to Rebus

The following table outlines what type of message is returned by each assertion method.

|Method|Rebus.TestHelpers MessageType|Generated by|
|------|-----------------------------|------------|
|HaveDeferredMessages|MessageDeferred<T>           |`bus.Defer(TimeSpan.Max, "msg")`|
|HaveDeferredToDesinationMessages|MessageDeferredToDestination<T>|`bus.Advanced.Routing.Defer("queue", TimeSpan.Max, "msg")`|
|HaveDeferredToSelfMessages|MessageDeferredToSelf<T>     |`bus.DeferLocal(TimeSpan.Max, "msg")`|
|HavePublishedMessages|MessagePublished<T>          |`bus.Publish("event")`|
|HavePublishedToTopicMessages|MessagePublishedToTopic<T>   |`bus.Advanced.Topics.Publish("topic", "event")`|
|HaveSentMessages|MessageSent<T>               |`bus.Send("msg")`|
|HaveSentToDestinationMessages|MessageSentToDestination<T>  |`bus.Advanced.Routing.Send("queue", "msg")`|
|HaveSentToSelfMessages|MessageSentToSelf<T>         |`bus.SendLocal("msg")`|
|HaveSentWithRoutingSlipMessages|MessageSentWithRoutingSlip   |`bus.Advanced.Routing.SendRoutingSlip(new Itinerary(), "msg")`|

